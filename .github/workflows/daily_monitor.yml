name: 천안공장 온도 자동수집 (10분 간격)

on:
  schedule:
    - cron: '*/10 * * * *'
  workflow_dispatch:

# ▼▼▼ [핵심] 열쇠 꾸러미를 '맨 위'로 뺐습니다. (들여쓰기 실수 방지) ▼▼▼
env:
  TUYA_API_KEY: ${{ secrets.TUYA_API_KEY }}
  TUYA_API_SECRET: ${{ secrets.TUYA_API_SECRET }}
  SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
  SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
  DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}

jobs:
  run-sensor-check:
    runs-on: ubuntu-latest
    steps:
      - name: 코드 가져오기
        uses: actions/checkout@v3

      - name: 파이썬 설치
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 필요 도구 설치
        run: pip install -r requirements.txt

      - name: 수집기 실행
        run: python collect_once.py
